<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ¡ å‹•ç‰©æ£®å‹æœƒé¢¨æ ¼çš„å°ç£å¤©æ°£èˆ‡æ—…éŠåœ°åœ– (ç²¾ç°¡å¤©æ°£ç‰ˆ)</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ================================================= */
        /* --- 1. ä»»å¤©å ‚å‹•ç‰©æ£®å‹æœƒé¢¨æ ¼æ¨£å¼ (ACNH Style) --- */
        /* ================================================= */

        :root {
            /* ä¸»è¦ä¸»é¡Œè‰² */
            --ac-blue: #a0d8f0; /* å¤©ç©ºè— */
            --ac-green: #c0f0a0; /* è‰åœ°ç¶  */
            --ac-text: #4a4a4a; /* æ·±ç°æ–‡å­— */
            --ac-accent: #ff80a0; /* ç²‰ç´…è‰²äº®é» (é¸å–è‰²) */
            --ac-shadow: rgba(0, 0, 0, 0.15); /* è¼ƒæ˜é¡¯çš„é™°å½± */
            --ac-border-color: #6a5a4a; /* æ·±æ£•è‰²é‚Šæ¡† */
            --ac-panel-bg: #fffaf0; /* ä»‹é¢åº•è‰² (å¥¶ç™½) */
        }

        body {
            font-family: 'Fredoka', 'Noto Sans TC', cursive, sans-serif;
            background-color: var(--ac-blue); 
            background-image: linear-gradient(to top, var(--ac-green) 50%, var(--ac-blue) 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--ac-text);
            padding-bottom: 50px; 
        }

        h1 {
            color: #d9534f;
            background-color: #fff;
            padding: 10px 30px;
            border-radius: 20px;
            border: 3px solid var(--ac-accent); 
            box-shadow: 0 4px 6px var(--ac-shadow);
            margin-top: 30px;
            margin-bottom: 20px; /* èª¿æ•´ä¸‹æ–¹é–“è· */
            font-size: 28px;
            letter-spacing: 2px;
            text-shadow: 1px 1px 0 #fff; 
        }

        /* --- æ–°å¢ï¼šå¼•å°åœ–ç‰‡æ¨£å¼ --- */
        .intro-image {
            max-width: 800px; /* é™åˆ¶æœ€å¤§å¯¬åº¦ */
            width: 90%; /* RWD: åœ¨å°è¢å¹•ä¸Šä½” 90% å¯¬åº¦ */
            height: auto; /* ä¿æŒæ¯”ä¾‹ */
            margin-bottom: 30px; /* èˆ‡ä¸‹æ–¹å…§å®¹ä¿æŒé–“è· */
            border-radius: 15px; /* åœ“è§’ */
            box-shadow: 0 4px 8px var(--ac-shadow); /* é™°å½±æ•ˆæœ */
        }

        /* --- æ¨™é¡Œèˆ‡å…§åµŒèªªæ˜åœ– (æ”¾åœ¨æ¨™é¡Œæ—) --- */
        .header-row {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
            width: 100%;
            box-sizing: border-box;
            padding: 0 10px;
            margin-bottom: 12px;
        }

        .intro-inline {
            width: 64px; /* ç¸®å°å°ºå¯¸ */
            height: auto;
            border-radius: 10px;
            box-shadow: 0 3px 6px var(--ac-shadow);
            cursor: pointer;
            flex-shrink: 0;
            transition: transform 0.15s ease, opacity 0.15s ease;
        }

        .intro-inline:hover {
            transform: scale(1.05);
            opacity: 0.95;
        }

        @media (max-width: 600px) {
            .header-row { flex-direction: column; gap: 8px; }
            .intro-inline { width: 80%; max-width: 300px; }
        }

        /* --- Layout: ä¿æŒä¸‰æ¬„ä½ˆå±€è¨­å®š --- */
        .container {
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center;
            gap: 25px; 
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
            max-width: 1500px; 
        }

        #mapBox {
            flex-basis: 50%; 
            max-width: 700px;
            min-width: 300px;
            flex-grow: 1;
            /* AC é¢¨æ ¼é‚Šæ¡† */
            border: 5px solid var(--ac-border-color);
            border-radius: 15px;
            background-color: var(--ac-green);
            box-shadow: 5px 5px 0 0 var(--ac-shadow);
            padding: 10px;
        }

        #taiwanMap {
            width: 100%;
            height: auto;
            border-radius: 5px; 
        }

        /* --- Panel å®¹å™¨é€šç”¨æ¨£å¼ (å¤©æ°£å’Œè§€å…‰) --- */
        #weatherPanel, #tourismPanel {
            flex-basis: 23%; 
            min-width: 300px; 
            flex-grow: 1;
            /* AC é¢¨æ ¼è¦†è“‹ */
            border: 3px solid var(--ac-border-color); 
            border-radius: 20px; 
            background: var(--ac-panel-bg); 
            box-shadow: 5px 5px 0 0 var(--ac-shadow); 
            overflow: hidden;
            display: flex;
            flex-direction: column; 
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        #weatherPanel:hover, #tourismPanel:hover {
             transform: translateY(-5px);
             box-shadow: 8px 8px 0 0 var(--ac-shadow);
        }

        /* --- æ¨™é¡Œé€šç”¨æ¨£å¼ --- */
        .section-title {
            padding: 18px 25px;
            margin: 0;
            font-size: 22px;
            font-weight: 700;
            border-bottom: 3px solid var(--ac-border-color); 
            border-radius: 17px 17px 0 0; 
        }

        /* --- å¤©æ°£æ¨™é¡Œ (å·¦å´) --- */
        #cityTitle {
            color: var(--ac-text);
            background-color: var(--ac-blue); 
            text-shadow: 1px 1px 0 #fff;
        }

        /* --- è§€å…‰æ¨™é¡Œ (å³å´) --- */
        #tourismPanel .section-title {
            color: var(--ac-text);
            background-color: var(--ac-accent); 
            text-shadow: 1px 1px 0 #fff;
        }

        /* --- å…§å®¹å€åŸŸå…§é‚Šè· --- */
        .panel-content {
            padding: 20px 25px;
            flex-grow: 1; 
        }
        
        /* --- Hover & Selection --- */
        .city-area:hover {
            fill: var(--ac-accent) !important; 
            cursor: url('AC_Shovel_Cursor.png'), pointer; 
            opacity: 0.9;
            transition: fill 0.3s; 
        }
        .city-area[fill="#e83e8c"] { 
             fill: var(--ac-accent) !important;
        }

        /* --- å¡ç‰‡æ¨£å¼ (å¤©æ°£ & æ™¯é») (AC é¢¨æ ¼èª¿æ•´) --- */
        #weatherResult, #touristSpotsList {
            gap: 15px; 
        }
        
        .forecast-card, .spot-card {
            padding: 15px;
            border: 2px dashed var(--ac-accent); 
            border-radius: 12px;
            background-color: #ffffff;
            box-shadow: 0 2px 4px var(--ac-shadow);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .forecast-card:hover, .spot-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--ac-shadow);
        }

        .spot-card h4 { color: #8b4513; } 
        .forecast-card p, .spot-card p { font-size: 15px; color: var(--ac-text); }
        .temp-range { color: #d9534f; font-weight: bold; }
        
        /* --- ç©¿æ­å»ºè­°å€å¡Šæ¨£å¼ --- */
        .clothing-advice {
            margin-top: 10px;
            padding-top: 5px; 
            border-top: 1px solid #eee; 
            color: var(--ac-text); 
            font-weight: bold;
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        
        .clothing-icon {
            width: 30px;
            height: 30px;
            object-fit: cover;
            border-radius: 3px;
            flex-shrink: 0; 
        }

        .icon-wrapper {
            cursor: pointer;
            display: inline-block;
            line-height: 0; 
            transition: opacity 0.2s;
        }

        .icon-wrapper:hover {
            opacity: 0.8;
        }
        
        /* --- åœ–ç‰‡æ”¾å¤§ Modal æ¨£å¼ (ä¿æŒä¸è®Š) --- */
        #imageModal {
            display: none; 
            position: fixed;
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.9); 
            align-items: center;
            justify-content: center;
        }
        #modalContent {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 900px;
            max-height: 90vh;
            object-fit: contain; 
        }
        .close-btn {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
        }

        /* --- é©šå–œæ°£æ³¡ (Surprise Bubble) --- */
        #surpriseBubble {
            position: absolute;
            display: none; 
            padding: 15px 20px;
            background-color: #fffaf0; 
            border: 3px solid var(--ac-border-color);
            border-radius: 20px;
            box-shadow: 5px 5px 0 0 var(--ac-shadow);
            z-index: 999;
            max-width: 250px;
            text-align: center;
            clip-path: polygon(
                0% 0%, 100% 0%, 100% 80%, 75% 80%, 65% 100%, 55% 80%, 0% 80%
            );
            animation: bounceIn 0.3s ease-out; 
            cursor: pointer;
            user-select: none; 
        }

        #surpriseBubble p {
            margin: 0;
            font-weight: 700;
            color: var(--ac-text);
            font-size: 16px;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }


        /* ------------------------------------------- */
        /* --- RWD Media Query (åˆ‡æ›åˆ°å †ç–Šä½ˆå±€) --- */
        /* ------------------------------------------- */
        @media (max-width: 1200px) {
            .container {
                flex-direction: column; 
                align-items: center;
                gap: 25px; 
            }

            #mapBox, #weatherPanel, #tourismPanel {
                max-width:600px; 
                width: 90%;
                flex-basis: auto; 
            }
            
            .panel-content {
                /* æ‰‹æ©Ÿä¸Šé™åˆ¶é«˜åº¦ï¼Œå…è¨±æ²å‹•ï¼Œé¿å…å…§å®¹éé•· */
                max-height: 400px; 
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
        }
        
        @media (max-width: 900px) {
            .section-title { padding: 15px 20px; font-size: 20px; }
            .panel-content { padding: 15px 20px; }
            h1 { font-size: 24px; padding: 10px 20px; } /* RWD: æ¨™é¡Œç¸®å° */
        }
    </style>
</head>
<body>

<div class="header-row">
    <h1>
        ğŸ‰ æ­¡è¿ä¾†åˆ°å°ç£å³¶ï¼
    </h1>
    <img src="image_0.png" alt="èªªæ˜åœ–ï¼šé»é¸åœ°åœ–åŸå¸‚ï¼Œç™¼ç¾é©šå–œï¼" class="intro-inline" onclick="openModal('image_0.png')" role="button" aria-label="æ”¾å¤§èªªæ˜åœ–">
</div>

<div class="container">
    
    <div id="weatherPanel">
        <h2 id="cityTitle" class="section-title">â˜ï¸ å¤©æ°£è³‡è¨Š</h2>
        <div class="panel-content">
            <div id="weatherResult">è«‹é»é¸åœ°åœ–ä¸Šçš„ç¸£å¸‚</div>
        </div>
    </div>

    <div id="mapBox">
        <object id="taiwanMap" type="image/svg+xml" data="country.svg"></object> 
    </div>

    <div id="tourismPanel">
        <h3 class="section-title">ğŸ—ºï¸ è§€å…‰æ™¯é»</h3>
        <div class="panel-content">
            <div id="touristSpotsList"></div>
        </div>
    </div>
</div>

<div id="surpriseBubble" onclick="hideSurpriseBubble()">
    <p></p>
</div>

<div id="imageModal" onclick="closeModal()">
    <span class="close-btn">&times;</span> 
    <img id="modalContent" onclick="event.stopPropagation()">
</div>
<script>
// â­ å®šç¾©é¡è‰²å¸¸é‡
const UNSELECTED_COLOR = '#CCCCCC';
const SELECTED_COLOR = '#ff80a0'; 
const LOADING_COLOR = '#f3cf00'; 

let weatherCache = null; 
const WEATHER_API_URL = "https://jringyoutask2.zeabur.app/api/weather/getAllCityWeather";
const TOURISM_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTVFoVhXMpRlpAlYahbf4tT5dsXZd3_Mb4mERIjjphpl3NYhpg_NfzIQfs7JVyczTizIKXhaiTm1L2Y/pub?gid=0&single=true&output=csv";

/* ================================================= */
/* --- åœ–ç‰‡æ”¾å¤§/ç¸®å°å‡½æ•¸ --- */
/* ================================================= */
const modal = document.getElementById("imageModal");
const modalImg = document.getElementById("modalContent");

function openModal(imgSrc) {
    modal.style.display = "flex"; 
    modalImg.src = imgSrc; 
}

function closeModal() {
    modal.style.display = "none";
}

if (document.querySelector(".close-btn")) {
    document.querySelector(".close-btn").onclick = closeModal;
}

/* ================================================= */
/* --- è§€å…‰æ™¯é»è™•ç† (ä¿æŒä¸è®Š) --- */
/* ================================================= */
function processTourismData(data, city, spotsList) {
    spotsList.innerHTML = '';
    const normalizedCity = city.replace('è‡º', 'å°').trim();
    const scenicSpots = data.filter(spot => 
        spot.City && spot.City.replace('è‡º', 'å°').includes(normalizedCity)
    ).slice(0, 5); 

    if (scenicSpots && scenicSpots.length > 0) {
        scenicSpots.forEach(spot => {
            const card = document.createElement('div');
            card.classList.add('spot-card');
            
            const city = spot.City;
            const area = spot.Spot;
            const story = spot.Story ;
            const food = spot.Food ;
            const imageUrl = spot.PictureUrl || '';

            card.innerHTML = `
                <h4>ğŸ“${city} - ${area}</h4>
                <p>ğŸ“œ ${story || 'æ²’æœ‰ç‰¹åˆ¥çš„æ•…äº‹ç´€éŒ„...'} </p> Â  Â  Â  Â  Â  Â  
                ${imageUrl ? `<img src="${imageUrl}" alt="${city}" style="width:100%; height:auto; border-radius:4px; margin-bottom:8px;">` : ''}
                <p>ğŸ´ç¾é£Ÿï¼š${food || 'æ²’æœ‰ç‰¹åˆ¥çš„ç¾é£Ÿç´€éŒ„...'}</p>
            `;
            spotsList.appendChild(card);
        });
    } else {
        spotsList.innerHTML = '<p style="text-align:center; color:#888; padding: 10px 0;">æŸ¥ç„¡ç›¸é—œè§€å…‰æ™¯é»è³‡æ–™ã€‚</p>';
    }
}


function loadTouristSpots(city) {
    const spotsList = document.getElementById("touristSpotsList");
    spotsList.innerHTML = '<p style="text-align:center; color:#888; padding: 10px 0;">æ™¯é»è³‡æ–™è¼‰å…¥ä¸­...</p>';

    if (window.tourismDataCache) {
        processTourismData(window.tourismDataCache, city, spotsList);
        return;
    }

    fetch(TOURISM_CSV_URL)
        .then(response => {
            if (!response.ok) {
                throw new Error(`CSV è¼‰å…¥éŒ¯èª¤: ${response.status} ${response.statusText}`);
            }
            return response.text();
        })
        .then(csvText => {
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) {
                spotsList.innerHTML = '<p style="text-align:center; color:#888; padding: 10px 0;">CSV è³‡æ–™ç„¡å…§å®¹æˆ–æ ¼å¼éŒ¯èª¤ã€‚</p>';
                return;
            }

            const headers = lines[0].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(h => h.trim().toLowerCase().replace(/^"|"$/g, ''));
            
            const spotIndex = headers.findIndex(h => h.includes('spot') || h.includes('æ™¯é»'));
            const cityIndex = headers.findIndex(h => h.includes('city') || h.includes('ç¸£å¸‚'));
            const foodIndex = headers.findIndex(h => h.includes('food') || h.includes('ç¾é£Ÿ'));
            const storyIndex = headers.findIndex(h => h.includes('story')  || h.includes('æ•…äº‹'));
            const imageUrlIndex = headers.findIndex(h => h.includes('imgurl')  || h.includes('åœ–ç‰‡'));

            if (spotIndex === -1 || cityIndex === -1) {
                   spotsList.innerHTML = '<p style="color:red; text-align:center; padding: 10px 0;">CSV æ ¼å¼éŒ¯èª¤: æ‰¾ä¸åˆ°æ™¯é»åç¨±æˆ–ç¸£å¸‚æ¬„ä½ã€‚</p>';
                   return;
            }
            
            const rawData = lines.slice(1).map(line => {
                   const values = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v.trim().replace(/^"|"$/g, ''));
                   return {
                       Spot: values[spotIndex] || 'æœªå‘½åæ™¯é»',
                       City: values[cityIndex] || '',
                       Story: values[storyIndex] || '',
                       Food: values[foodIndex] || '',
                       PictureUrl: values[imageUrlIndex] || ''
                   };
            });
            
            window.tourismDataCache = rawData; 
            processTourismData(rawData, city, spotsList);
        })
        .catch(error => {
            console.error('è¼‰å…¥è§€å…‰æ™¯é»ç™¼ç”ŸéŒ¯èª¤:', error);
            spotsList.innerHTML = `<p style="color:red; text-align:center; padding: 10px 0;">æ™¯é»è¼‰å…¥å¤±æ•—: ${error.message}</p>`;
        });
}


/* ================================================= */
/* --- å¤©æ°£èˆ‡ç©¿æ­è™•ç† --- */
/* ================================================= */
function getClothingAdvice(minTemp, maxTemp, rain, comfort) {
    const avgTemp = (minTemp + maxTemp) / 2;
    let advice = "";

    if (avgTemp >= 28) {
        advice = "é…·ç†±ï¼å»ºè­°ç©¿è‘—çŸ­è¢–ã€çŸ­è¤²ã€è£™å­ï¼Œä¸¦å‹™å¿…åšå¥½é˜²æ›¬åŠæ°´åˆ†è£œå……ã€‚";
    } else if (avgTemp >= 23) {
        advice = "æº«æš–èˆ’é©ï¼Œå»ºè­°ç©¿è‘— T æ¤ã€è–„é•·è¢–æˆ–æ´‹è£ï¼Œå‚™ä¸€ä»¶è–„å¤–å¥—å³å¯ã€‚";
    } else if (avgTemp >= 18) {
        advice = "ç¨æœ‰æ¶¼æ„ï¼Œå»ºè­°æ¡æ´‹è”¥å¼ç©¿æ³•ï¼Œç©¿è‘—é•·è¢–ã€è¡›è¡£æˆ–è–„æ¯›è¡£ï¼Œæ­é…å¤–å¥—ã€‚";
    } else if (avgTemp >= 13) {
        advice = "è¼ƒç‚ºå¯’å†·ï¼Œå»ºè­°ç©¿è‘—åšé•·è¢–ã€æ¯›è¡£æˆ–å¤¾å…‹ï¼Œä¸¦æ­é…é•·è¤²ã€‚";
    } else { // avgTemp <= 12
        advice = "å¯’å†·ï¼è«‹å‹™å¿…ç©¿è‘—åšå¤–å¥—ã€ç¾½çµ¨æœã€ç™¼ç†±è¡£å’Œåœå·¾ï¼ŒåŠ å¼·ä¿æš–ã€‚";
    }

    if (rain >= 50) {
        advice += " âš ï¸ä»Šæ—¥é™é›¨æ©Ÿç‡é«˜ï¼Œå‹™å¿…æ”œå¸¶é›¨å…·ä¸¦è€ƒæ…®ç©¿è‘—é˜²æ°´å¤–å¥—ã€‚";
    } else if (rain >= 30) {
        advice += " â˜”ï¸æœ‰å±€éƒ¨é™é›¨æ©Ÿæœƒï¼Œå»ºè­°æ”œå¸¶é›¨å…·å‚™ç”¨ã€‚";
    }

    if (comfort.includes('æ½®æ¿•') || comfort.includes('æ‚¶ç†±')) {
        advice += " ğŸ’§é«”æ„Ÿåæ½®æ¿•æ‚¶ç†±ï¼Œå»ºè­°é¸æ“‡é€æ°£å¸æ±—æè³ªçš„è¡£ç‰©ã€‚";
    } else if (comfort.includes('æ¶¼çˆ½') || comfort.includes('èˆ’é©')) {
        advice += " â˜€ï¸é«”æ„Ÿèˆ’é©ï¼Œè¼•é¬†äº«å—å¥½å¤©æ°£ï¼";
    }

    return advice;
}

function getClothingIcon(avgTemp) {
    if (avgTemp >= 28) { return 'Clother_01.png'; } 
    else if (avgTemp >= 23) { return 'Clother_02.png'; } 
    else if (avgTemp >= 18) { return 'Clother_03.png'; } 
    else if (avgTemp >= 13) { return 'Clother_04.png'; } 
    else { return 'Clother_05.png'; } 
}

function getClothingImg(avgTemp) {
    const iconUrl = getClothingIcon(avgTemp);
    return `
        <div class="icon-wrapper" onclick="openModal('${iconUrl}')">
            <img src="${iconUrl}" class="clothing-icon" alt="ç©¿æ­åœ–ç¤º">
        </div>
    `;
}

/**
 * â­ è¼‰å…¥å¤©æ°£è³‡æ–™ (åƒ…é¡¯ç¤ºç¬¬ä¸€å€‹é å ±æ™‚æ®µ) â­
 * @param {string} city - åŸå¸‚åç¨±
 * @param {SVGElement} svgElement - è¢«é»æ“Šçš„ SVG å…ƒç´ 
 */
function loadWeather(city, svgElement) {
    const resultContainer = document.getElementById("weatherResult");
    const spotsList = document.getElementById("touristSpotsList");
    const cityTitle = document.getElementById("cityTitle");
    
    cityTitle.innerHTML = `ã€${city}ã€‘è®€å–ä¸­... <img src="ac_loading.gif" alt="è¼‰å…¥ä¸­" style="height:20px; vertical-align:middle;">`; 
    resultContainer.innerHTML = '<p style="text-align:center; color:#888; padding: 10px 0;">å¤©æ°£è³‡æ–™è¼‰å…¥ä¸­...</p>';
    spotsList.innerHTML = '<p style="text-align:center; color:#888; padding: 10px 0;">æ™¯é»è³‡æ–™è¼‰å…¥ä¸­...</p>';
    
    if (svgElement) { svgElement.setAttribute('fill', LOADING_COLOR); }

    const dataPromise = weatherCache 
        ? Promise.resolve({ data: weatherCache }) 
        : fetch(WEATHER_API_URL).then(response => { 
            if (!response.ok) { throw new Error(`HTTP éŒ¯èª¤: ${response.status}`); }
            return response.json();
        });

    dataPromise
        .then(responseData => {
            if (!weatherCache) { weatherCache = responseData.data; }
            const allCityData = weatherCache; 

            if (svgElement) { svgElement.setAttribute('fill', SELECTED_COLOR); }

            const found = allCityData.find(item => item.city && item.city.includes(city));

            if (found && found.forecasts && found.forecasts.length > 0) {
                
                // â­ åªå–ç¬¬ä¸€å€‹é å ±æ™‚æ®µ (ç²¾ç°¡ç‰ˆ)
                const el = found.forecasts[0]; 
                
                cityTitle.innerText = `â˜€ï¸ ${found.city}ï¼šç›®å‰èˆ‡è¿‘æœŸé å ±`; 
                resultContainer.innerHTML = ''; 

                const card = document.createElement('div');
                card.classList.add('forecast-card');
                
                const startTimeText = el.startTime.substring(5, 16).replace('-', '/');
                const endTimeText = el.endTime.substring(11, 16);
                
                const minTemp = parseFloat(el.minTemp);
                const maxTemp = parseFloat(el.maxTemp);
                const rain = parseFloat(el.rain);
                
                const avgTemp = (minTemp + maxTemp) / 2; 
                const clothingAdvice = getClothingAdvice(minTemp, maxTemp, rain, el.comfort);
                const clothingImgHtml = getClothingImg(avgTemp);
                
                card.innerHTML = `
                    <h4>ğŸ“… ${startTimeText} ~ ${endTimeText}</h4>
                    <p>â˜ï¸ å¤©æ°£ï¼š${el.weather}</p>
                    <p class="temp-range">
                        ğŸŒ¡ æº«åº¦ï¼š${el.minTemp}Â°C ~ ${el.maxTemp}Â°C
                    </p>
                    <p>ğŸ‘¤ é«”æ„Ÿï¼š${el.comfort}</p>
                    <p>ğŸ’§ é™é›¨ç‡ï¼š${el.rain}%</p>
                    <div class="clothing-advice">
                        ${clothingImgHtml}
                        <span>ğŸ§¥ å»ºè­°ç©¿æ­ï¼š${clothingAdvice}</span>
                    </div>
                `;
                resultContainer.appendChild(card);
                
                // å‘¼å«è§€å…‰æ™¯é»
                loadTouristSpots(found.city);

            } else {
                cityTitle.innerText = "å¤©æ°£è³‡è¨Š (æŸ¥ç„¡è³‡æ–™)";
                resultContainer.innerHTML = `<p style="color:red; text-align:center; padding: 10px 0;">æŸ¥ç„¡ ${city} çš„å¤©æ°£è³‡æ–™ã€‚</p>`;
                spotsList.innerHTML = '<p style="text-align:center; color:#888; padding: 10px 0;">è«‹é»é¸åœ°åœ–ä¸Šçš„ç¸£å¸‚</p>';
            }
        })
        .catch(error => {
            if (svgElement) { svgElement.setAttribute('fill', SELECTED_COLOR); }
            cityTitle.innerText = "å¤©æ°£è³‡è¨Š (è¼‰å…¥å¤±æ•—)";
            resultContainer.innerHTML = `<p style="color:red; text-align:center; padding: 10px 0;">å¤©æ°£è³‡æ–™è¼‰å…¥å¤±æ•—ï¼ (${error.message})</p>`;
            spotsList.innerHTML = '<p style="text-align:center; color:#888; padding: 10px 0;">æ™¯é»è¼‰å…¥å¤±æ•—</p>';
            console.error('API è«‹æ±‚æˆ–è™•ç†ç™¼ç”ŸéŒ¯èª¤:', error);
        });
}

/* ================================================= */
/* --- é©šå–œæ°£æ³¡ (Surprise Logic) --- */
/* ================================================= */
const surpriseBubble = document.getElementById("surpriseBubble");
const surpriseMessages = [
    "å—¶ï¼æ‰¾åˆ°ä¸€é¡†éˆ´éŒ¢ï¼ğŸ’°",
    "ç™¼ç¾ç¨€æœ‰æ˜†èŸ²ï¼ğŸ",
    "ä»Šå¤©æ˜¯å‹•æ£®å±…æ°‘çš„ç”Ÿæ—¥å–”ï¼ğŸ‚",
    "å˜¿ï¼ä½ æŒ–åˆ°åŒ–çŸ³äº†ï¼ğŸ¦´",
    "ç‹¸å…‹æ­£åœ¨å·çœ‹ä½ å–”ï¼ğŸ¤«",
    "å’¦ï¼Ÿæœ‰æ¼‚æµç“¶ï¼ğŸŒŠ",
    "ä½ å‰›åš‡è·‘äº†ä¸€éš»é­šï¼ğŸŸ",
    "ä½ çš„æ‰‹æ©Ÿæ”¶åˆ°ä¸€å°ä¿¡ï¼ğŸ’Œ",
    "å“‡ï¼ç™¼ç¾ç«¹ç­äº†ï¼ğŸ",
    "æº–å‚™å¥½ä½ çš„æ•èŸ²ç¶²äº†å—ï¼Ÿ",
    "ä¸€èµ·å»é‡£é­šå§ï¼ğŸ£"
];

function hideSurpriseBubble() {
    surpriseBubble.style.display = 'none';
}

function showSurpriseBubble(event) {
    const randomIndex = Math.floor(Math.random() * surpriseMessages.length);
    const message = surpriseMessages[randomIndex];
    
    surpriseBubble.querySelector('p').innerText = message;
    
    let x = event.clientX;
    let y = event.clientY;

    // ä½¿ç”¨ transform ç¢ºä¿åœ¨é»æ“Šä½ç½®ä¸Šæ–¹ç½®ä¸­
    surpriseBubble.style.left = `${x}px`;
    surpriseBubble.style.top = `${y - 30}px`; 
    surpriseBubble.style.transform = 'translate(-50%, -100%)'; 

    surpriseBubble.style.display = 'block';

    setTimeout(hideSurpriseBubble, 2500);
}

// ç›£è½ mapBox å€åŸŸçš„é»æ“Šäº‹ä»¶ (åŒ…å« SVG å’Œå…¶å‘¨åœ)ï¼Œç”¨æ–¼è§¸ç™¼é©šå–œ
document.getElementById("mapBox").addEventListener("click", (event) => {
    showSurpriseBubble(event);
});


/* ===========================
    å•Ÿå‹• SVG é»æ“Šäº‹ä»¶ (åŸå¸‚é¸æ“‡)
============================= */
document.getElementById("taiwanMap").addEventListener("load", () => {
    const svgObject = document.getElementById("taiwanMap");
    const svg = svgObject.contentDocument;

    const areas = svg.querySelectorAll("[data-city]");
    
    let selectedArea = null; 

    areas.forEach(area => {
        area.classList.add("city-area");
        
        area.setAttribute('fill', UNSELECTED_COLOR);
        area.style.transition = 'fill 0.3s ease'; 
        
        area.addEventListener("click", (event) => {
            
            if (selectedArea && selectedArea !== area) {
                selectedArea.setAttribute('fill', UNSELECTED_COLOR);
            }

            area.setAttribute('fill', SELECTED_COLOR);
            selectedArea = area;
            
            const cityName = area.getAttribute("data-city");
            loadWeather(cityName, area); 
        });
    });
});
</script>

</body>
</html>