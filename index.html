<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Taiwan Weather Map</title>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, "Noto Sans TC", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f8f8f8;
        }

        h1 {
            margin-top: 20px;
            text-align: center;
            color: #333;
        }

        /* --- Layout --- */
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
            max-width: 1400px;
        }

        /* --- SVG Map --- */
        #mapBox {
            width: 100%;
            max-width: 700px;
        }

        #taiwanMap {
            width: 100%;
            height: auto;
        }

        /* --- Hover Area Highlight --- */
        .city-area:hover {
            fill: #007bff !important;
            cursor: pointer;
            opacity: 0.8;
            transition: fill 0.3s; 
        }

        /* --- Weather Info Container --- */
        #infoBox {
            border: 1px solid #ddd;
            padding: 15px;
            width: 100%;
            max-width: 450px;
            border-radius: 8px;
            background: #fff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        }
        
        #infoBox h2 {
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-top: 0;
            color: #007bff;
        }

        /* --- å¡ç‰‡å®¹å™¨ --- */
        #weatherResult {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding-top: 5px; 
            min-height: 100px;
        }

        /* --- å¡ç‰‡æ¨£å¼ --- */
        .forecast-card {
            border: 1px solid #e0e0e0;
            padding: 12px;
            border-radius: 6px;
            background-color: #fefefe;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .forecast-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .forecast-card h4 {
            margin: 0 0 8px 0;
            font-size: 15px;
            color: #555;
            font-weight: 600;
            border-bottom: 1px dashed #eee;
            padding-bottom: 5px;
        }

        .forecast-card p {
            margin: 3px 0;
            font-size: 15px;
        }

        .temp-range {
            color: #d9534f;
            font-weight: bold;
        }
        
        /* ------------------------------- */
        /* --- â­ RWD å„ªåŒ– Media Query --- */
        /* ------------------------------- */
        @media (max-width: 900px) {
            .container {
                /* ç¸®å°å®¹å™¨é–“è· */
                gap: 15px; 
                padding: 10px;
            }
            h1 {
                /* ç¸®å°æ¨™é¡Œä¸Šé–“è· */
                margin-top: 15px;
                font-size: 26px;
            }
            /* ç¢ºä¿åœ°åœ–å’Œè³‡è¨Šæ¬„åœ¨å°è¢å¹•æ™‚éƒ½èƒ½ä½”æ»¿å¯ç”¨å¯¬åº¦ */
            #mapBox, #infoBox {
                max-width: 100%; 
            }
        }
        
        @media (max-width: 500px) {
            #infoBox {
                /* ç¸®å°æ‰‹æ©Ÿä¸Šçš„å…§é‚Šè· */
                padding: 10px; 
            }
            .forecast-card p {
                /* ç¸®å°å¡ç‰‡å…§æ–‡å­—é«” */
                font-size: 14px;
            }
        }
    </style>
</head>
<body>

<h1>å°ç£å¤©æ°£åœ°åœ–</h1>

<div class="container">
    <div id="infoBox">
        <h2 id="cityTitle">å¤©æ°£è³‡è¨Š</h2>
        <div id="weatherResult">è«‹é»é¸åœ°åœ–ä¸Šçš„ç¸£å¸‚</div>
    </div>
      <div id="mapBox">
        <object id="taiwanMap" type="image/svg+xml" data="country.svg"></object> 
    </div>
    <div id="touristSpotsContainer">
        <h3>è§€å…‰æ™¯é»</h3>
        <div id="touristSpotsList"></div>
    </div>
</div>

<script>
// â­ å®šç¾©é¡è‰²å¸¸é‡
const UNSELECTED_COLOR = '#CCCCCC'; // é è¨­åº•è‰² (æ·ºç°)
const SELECTED_COLOR = '#e83e8c'; // é»é¸é«˜äº®è‰² (æ´‹ç´…è‰²)
const LOADING_COLOR = '#ffc107'; // è¼‰å…¥ç‰¹æ•ˆè‰² (é»ƒè‰²)

/**
 * æ ¹æ“šåŸå¸‚åç¨±è¼‰å…¥å¤©æ°£è³‡æ–™ä¸¦ä»¥å¡ç‰‡å½¢å¼é¡¯ç¤º
 * @param {string} city - åŸå¸‚åç¨±
 * @param {SVGElement} svgElement - è¢«é»æ“Šçš„ SVG å…ƒç´ 
 */
function loadWeather(city, svgElement) {
    const resultContainer = document.getElementById("weatherResult");
    const cityTitle = document.getElementById("cityTitle");
    
    cityTitle.innerText = `ã€${city}ã€‘è®€å–ä¸­...`;
    resultContainer.innerHTML = '<p style="text-align:center; color:#888;">è³‡æ–™æ­£åœ¨è¼‰å…¥ï¼Œè«‹ç¨å€™...</p>';
    
    // é–‹å§‹ç‰¹æ•ˆï¼šç›´æ¥è¨­å®š fill å±¬æ€§
    if (svgElement) {
        svgElement.setAttribute('fill', LOADING_COLOR);
    }

    fetch("https://jringyoutask2.zeabur.app/api/weather/getAllCityWeather")
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP éŒ¯èª¤: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            // è¼‰å…¥å®Œæˆï¼šæ¢å¾©é¸ä¸­é¡è‰²
            if (svgElement) {
                svgElement.setAttribute('fill', SELECTED_COLOR);
            }

            const allCities = data.data;
            const found = allCities.find(item => item.city && item.city.includes(city));

            if (found) {
                cityTitle.innerText = `${found.city}ï¼šä¸‰åå…­å°æ™‚å¤©æ°£é å ±`; 
                resultContainer.innerHTML = ''; 
                
                found.forecasts.forEach(el => {
                    const card = document.createElement('div');
                    card.classList.add('forecast-card');
                    
                    const startTimeText = el.startTime.substring(5, 16).replace('-', '/');
                    const endTimeText = el.endTime.substring(11, 16);
                    
                    card.innerHTML = `
                        <h4>ğŸ“… ${startTimeText} ~ ${endTimeText}</h4>
                        <p>â˜ï¸ å¤©æ°£ï¼š${el.weather}</p>
                        <p class="temp-range">
                            ğŸŒ¡ æº«åº¦ï¼š${el.minTemp} ~ ${el.maxTemp}
                        </p>
                        <p>ğŸ‘¤ é«”æ„Ÿï¼š${el.comfort}</p>
                        <p>ğŸ’§ é™é›¨ç‡ï¼š${el.rain}</p>
                    `;

                    resultContainer.appendChild(card);
                });

            } else {
                cityTitle.innerText = "å¤©æ°£è³‡è¨Š";
                resultContainer.innerHTML = `<p style="color:red; text-align:center;">æŸ¥ç„¡ ${city} çš„å¤©æ°£è³‡æ–™ã€‚</p>`;
            }
        })
        .catch(error => {
            // éŒ¯èª¤ç™¼ç”Ÿï¼šæ¢å¾©é¸ä¸­é¡è‰²
            if (svgElement) {
                svgElement.setAttribute('fill', SELECTED_COLOR);
            }
            cityTitle.innerText = "å¤©æ°£è³‡è¨Š (è¼‰å…¥å¤±æ•—)";
            console.error('API è«‹æ±‚æˆ–è™•ç†ç™¼ç”ŸéŒ¯èª¤:', error);
            resultContainer.innerHTML = `<p style="color:red; text-align:center;">è³‡æ–™è¼‰å…¥å¤±æ•—ï¼ (${error.message})</p>`;
        });
}


/* ===========================
    å•Ÿå‹• SVG é»æ“Šäº‹ä»¶ (ä½¿ç”¨ JS æ§åˆ¶é¡è‰²)
============================= */
document.getElementById("taiwanMap").addEventListener("load", () => {
    const svgObject = document.getElementById("taiwanMap");
    const svg = svgObject.contentDocument;

    const areas = svg.querySelectorAll("[data-city]");
    
    // è¿½è¹¤ç•¶å‰è¢«é¸ä¸­çš„å€åŸŸ
    let selectedArea = null; 

    areas.forEach(area => {
        // è³¦äºˆ class (åƒ…ä¾› CSS hover ä½¿ç”¨)
        area.classList.add("city-area");
        
        // ç¢ºä¿æ‰€æœ‰å€åŸŸéƒ½æœ‰ä¸€å€‹ä¸€è‡´çš„é è¨­é¡è‰²ï¼Œä¸¦å…è¨± transition
        area.setAttribute('fill', UNSELECTED_COLOR);
        area.style.transition = 'fill 0.3s ease'; // ç›´æ¥åœ¨å…ƒç´ ä¸Šè¨­å®šå‹•ç•«
        
        area.addEventListener("click", () => {
            
            // 1. ç§»é™¤å…ˆå‰è¢«é¸ä¸­å€åŸŸçš„é«˜äº® (æ¢å¾©é è¨­é¡è‰²)
            if (selectedArea && selectedArea !== area) {
                selectedArea.setAttribute('fill', UNSELECTED_COLOR);
            }

            // 2. å°ç•¶å‰é»æ“Šçš„å€åŸŸè¨­å®šé«˜äº®é¡è‰²
            area.setAttribute('fill', SELECTED_COLOR);
            
            // 3. æ›´æ–°è¿½è¹¤è®Šæ•¸
            selectedArea = area;
            
            const cityName = area.getAttribute("data-city");
            loadWeather(cityName, area); 
        });
    });
});
</script>

</body>
</html>